# W3：模擬器中的起飛與降落

**課程名稱**：飛行驅動 Python - Week 3
**授課時數**：3 小時（150 分鐘）
**適用對象**：高中學生
**教學日期**：____________
**授課教師**：____________

---

## 一、教學目標

### 知識目標
1. 理解程式執行的順序性（Sequential Execution）
2. 認識 time.sleep() 函數的作用與重要性
3. 了解無人機起飛與降落的基本原理

### 技能目標
1. 能在 Webots 中控制虛擬無人機起飛
2. 能使用 time.sleep() 控制動作時間
3. 能撰寫完整的起飛→懸停→降落程式
4. 能調整參數控制飛行高度與時間

### 態度目標
1. 培養對無人機飛行的興趣與成就感
2. 建立「測試→觀察→調整」的實驗精神
3. 理解程式邏輯對實體控制的重要性

---

## 二、教學準備

### 教師準備
- [ ] 教學簡報（PPT）
- [ ] Crazyflie 實機飛行影片（對照模擬器）
- [ ] 範例程式碼（起飛降落）
- [ ] 錯誤範例程式（教學用）
- [ ] 投影設備

### 學生準備
- [ ] 已完成 Webots 安裝（W2 檢查）
- [ ] W2 作業（供檢討）
- [ ] 學習筆記本

### 教學環境
- [ ] Webots 模擬器運行正常
- [ ] 所有電腦顯卡驅動更新
- [ ] 備用電腦（供設備故障學生使用）

---

## 三、教學流程（150 分鐘）

### 第一節：W2 回顧與程式順序性（50 分鐘）

#### 1-1. W2 作業檢討（15 分鐘）

**作業展示與討論**：

**優秀作業特點**：
1. 程式能正確執行
2. 輸出格式美觀
3. 註解清楚完整
4. 創意輸出畫面

**常見問題解答**：

**問題 1：Webots 閃退或卡頓**
```
原因：顯卡驅動過舊、記憶體不足
解決：
1. 降低模擬品質（Preferences > OpenGL）
2. 關閉其他程式
3. 更新顯卡驅動
```

**問題 2：找不到 controller 模組**
```python
# ❌ 錯誤
import controller
robot = controller.Robot()

# ✅ 正確
from controller import Robot
robot = Robot()
```

**問題 3：無限迴圈停不下來**
```python
# 記得要有結束條件
step_count = 0
while drone.step(timestep) != -1:
    step_count += 1
    if step_count >= 1000:
        break  # 重要！沒有 break 會無限執行
```

---

#### 1-2. 程式執行的順序性（15 分鐘）

**概念引入：早晨起床的順序**

```
情境：早上起床後要做的事

❌ 錯誤順序：
1. 出門上學
2. 吃早餐
3. 穿衣服
4. 起床
→ 這樣很奇怪！

✅ 正確順序：
1. 起床
2. 穿衣服
3. 吃早餐
4. 出門上學
→ 這才合理！
```

**Python 程式的執行順序**：

```python
# Python 從上往下，一行一行執行

print("第一步")    # 1. 先執行這行
print("第二步")    # 2. 再執行這行
print("第三步")    # 3. 最後執行這行

# 輸出：
# 第一步
# 第二步
# 第三步
```

**順序很重要的例子**：

```python
# ❌ 錯誤：先用後定義
print(name)      # 錯誤！name 還沒定義
name = "小明"

# ✅ 正確：先定義後用
name = "小明"
print(name)      # 正確！
```

**無人機飛行的順序**：

```python
# ❌ 錯誤順序
drone.land()        # 1. 降落（但還沒起飛！）
drone.takeoff()     # 2. 起飛（已經降落了）
# → 無人機不會飛

# ✅ 正確順序
drone.takeoff()     # 1. 先起飛
drone.land()        # 2. 再降落
# → 完整的飛行流程
```

**重點強調**：
```
程式執行 = 按照順序，一步一步來
就像：
- 做菜要按食譜順序
- 組裝要按說明書步驟
- 飛行也要按正確順序
```

---

#### 1-3. 為什麼需要 time.sleep()？（20 分鐘）

**問題引導**：

```python
# 請同學預測這個程式會發生什麼？
drone.takeoff()
drone.land()
```

**錯誤示範**（教師展示）：

```python
"""
錯誤範例：沒有 sleep 的後果
"""
from controller import Robot

drone = Robot()
timestep = int(drone.getBasicTimeStep())

# 取得馬達
m1 = drone.getDevice("m1_motor")
m2 = drone.getDevice("m2_motor")
m3 = drone.getDevice("m3_motor")
m4 = drone.getDevice("m4_motor")

# 設定模式
m1.setPosition(float('inf'))
m2.setPosition(float('inf'))
m3.setPosition(float('inf'))
m4.setPosition(float('inf'))

# 起飛（加大馬達轉速）
print("起飛！")
m1.setVelocity(50)
m2.setVelocity(50)
m3.setVelocity(50)
m4.setVelocity(50)

# 立刻降落（減小馬達轉速）
print("降落！")
m1.setVelocity(0)
m2.setVelocity(0)
m3.setVelocity(0)
m4.setVelocity(0)

while drone.step(timestep) != -1:
    pass
```

**觀察結果**：
- 無人機幾乎沒有動作
- 或者只是輕微震動
- 為什麼？因為指令「太快」了！

**類比說明**：

```
想像你對朋友說：
「跳起來！」「蹲下！」

如果這兩句話在 0.001 秒內說完：
→ 朋友根本來不及跳起來，就被叫要蹲下
→ 結果：什麼都沒做

正確做法：
「跳起來！」
（等待 3 秒）
「蹲下！」
→ 朋友有時間完成動作
```

**引入 time.sleep()**：

```python
import time

print("第一步")
time.sleep(2)      # 暫停 2 秒
print("第二步")    # 2 秒後才執行

# 執行結果：
# 第一步
# （等待 2 秒）
# 第二步
```

**正確的起飛程式**：

```python
import time
from controller import Robot

drone = Robot()
timestep = int(drone.getBasicTimeStep())

# 設定馬達...（省略）

print("準備起飛...")
m1.setVelocity(50)
m2.setVelocity(50)
m3.setVelocity(50)
m4.setVelocity(50)

print("起飛中...")
time.sleep(3)      # ⭐ 關鍵！等待 3 秒讓無人機起飛

print("準備降落...")
m1.setVelocity(0)
m2.setVelocity(0)
m3.setVelocity(0)
m4.setVelocity(0)

print("降落完成！")

while drone.step(timestep) != -1:
    pass
```

---

### 第二節：起飛與降落實作（50 分鐘）

#### 2-1. 完整起飛程式講解（20 分鐘）

**標準起飛程式範本**：

```python
"""
W3 標準範例：起飛與降落
功能：讓無人機起飛 → 懸停 3 秒 → 降落
"""

import time
from controller import Robot

# 初始化
drone = Robot()
timestep = int(drone.getBasicTimeStep())

# 取得四個馬達
m1_motor = drone.getDevice("m1_motor")
m2_motor = drone.getDevice("m2_motor")
m3_motor = drone.getDevice("m3_motor")
m4_motor = drone.getDevice("m4_motor")

# 設定馬達為速度控制模式
m1_motor.setPosition(float('inf'))
m2_motor.setPosition(float('inf'))
m3_motor.setPosition(float('inf'))
m4_motor.setPosition(float('inf'))

# 初始化馬達速度為 0
m1_motor.setVelocity(0)
m2_motor.setVelocity(0)
m3_motor.setVelocity(0)
m4_motor.setVelocity(0)

print("=" * 40)
print("  飛行任務：起飛與降落")
print("=" * 40)

# 起飛
print("🚀 起飛中...")
m1_motor.setVelocity(55)
m2_motor.setVelocity(55)
m3_motor.setVelocity(55)
m4_motor.setVelocity(55)

time.sleep(2)  # 等待 2 秒，讓無人機上升

# 懸停
print("✈️  懸停中...")
time.sleep(3)  # 懸停 3 秒

# 降落
print("🛬 降落中...")
m1_motor.setVelocity(0)
m2_motor.setVelocity(0)
m3_motor.setVelocity(0)
m4_motor.setVelocity(0)

time.sleep(2)  # 等待 2 秒，讓無人機降落

print("✅ 飛行任務完成！")
print("=" * 40)

# 主迴圈（讓模擬繼續運行）
while drone.step(timestep) != -1:
    pass
```

**程式碼分段講解**：

**1. 初始化階段**
```python
# 為什麼要初始化為 0？
m1_motor.setVelocity(0)
# → 確保馬達一開始是停止的
# → 避免意外啟動
```

**2. 起飛階段**
```python
m1_motor.setVelocity(55)  # 設定轉速
time.sleep(2)              # 等待上升
# → 轉速 55 是經過測試的值
# → 太小：無人機飛不起來
# → 太大：無人機會翻覆
```

**3. 懸停階段**
```python
time.sleep(3)
# → 維持原本的轉速
# → 只是等待，不改變設定
```

**4. 降落階段**
```python
m1_motor.setVelocity(0)  # 停止馬達
time.sleep(2)             # 等待降落
# → 關閉馬達，讓重力自然降落
```

---

#### 2-2. 參數調整實驗（15 分鐘）

**實驗 1：調整起飛轉速**

```python
# 請學生測試不同轉速的效果
velocity_values = [40, 50, 55, 60, 70]

# 觀察：
# velocity = 40  → 無人機飛不起來
# velocity = 50  → 勉強起飛
# velocity = 55  → 穩定起飛 ✅
# velocity = 60  → 上升太快
# velocity = 70  → 可能翻覆 ⚠️
```

**實驗 2：調整懸停時間**

```python
# 嘗試不同的懸停時間
hover_times = [1, 3, 5, 10]

time.sleep(hover_time)

# 觀察：時間越長，無人機在空中越久
```

**實驗 3：多段高度控制**

```python
# 階梯式上升
print("第一段上升...")
m1_motor.setVelocity(55)
time.sleep(1)  # 上升 1 秒

print("第二段上升...")
time.sleep(1)  # 再上升 1 秒

print("第三段上升...")
time.sleep(1)  # 再上升 1 秒

print("開始降落...")
m1_motor.setVelocity(0)
```

**教學重點**：
- 鼓勵學生實驗不同參數
- 觀察並記錄結果
- 找到最佳的飛行參數

---

#### 2-3. 學生實作練習（15 分鐘）

**練習 1：基礎起降（所有學生）**

```python
"""
任務：讓無人機起飛並懸停 5 秒後降落
要求：
1. 使用 time.sleep()
2. 輸出每個階段的訊息
3. 完整的起飛→懸停→降落流程
"""

# TODO：請完成程式碼
```

**練習 2：連續起降（進階）**

```python
"""
任務：讓無人機連續起降 3 次
流程：起飛 → 懸停 2 秒 → 降落 → 等待 1 秒 → 重複
"""

for i in range(3):
    print(f"第 {i+1} 次起飛")
    # TODO：起飛
    # TODO：懸停
    # TODO：降落
    # TODO：等待
```

**練習 3：創意飛行（挑戰）**

```python
"""
任務：設計一個有創意的飛行模式
範例：
- 階梯式上升（每次上升 1 秒，共 3 段）
- 跳躍式飛行（起飛→降落→起飛→降落）
- 模擬電梯（慢速上升，暫停，慢速下降）
"""

# 發揮你的創意！
```

---

### 第三節：飛行任務挑戰與總結（50 分鐘）

#### 3-1. 飛行任務挑戰賽（30 分鐘）

**任務 1：精準懸停（10 分鐘）**

```
目標：讓無人機在空中懸停剛好 10 秒
評分：
- 9.5-10.5 秒：優秀 ⭐⭐⭐
- 9.0-11.0 秒：良好 ⭐⭐
- 8.0-12.0 秒：及格 ⭐
```

**任務 2：階梯飛行（10 分鐘）**

```
目標：讓無人機飛出「階梯」效果
要求：
- 第一段：懸停 1 秒
- 第二段：上升後懸停 2 秒
- 第三段：再上升後懸停 3 秒
- 最後：降落

程式架構：
起飛 → 懸停 1s → 加速 → 懸停 2s → 加速 → 懸停 3s → 降落
```

**任務 3：安全降落（10 分鐘）**

```
目標：設計最平穩的降落程式
要求：
- 不能直接切斷馬達（會摔機）
- 要逐步降低轉速
- 平穩接觸地面

提示：
velocity = 55 → 40 → 30 → 20 → 10 → 0
每次降速之間等待 0.5 秒
```

**示範程式（教師提供）**：

```python
"""
安全降落示範
"""
import time
from controller import Robot

# ... 初始化省略 ...

# 起飛
print("起飛中...")
for motor in [m1_motor, m2_motor, m3_motor, m4_motor]:
    motor.setVelocity(55)
time.sleep(3)

# 懸停
print("懸停中...")
time.sleep(2)

# 逐步降落
print("開始平穩降落...")
for velocity in [40, 30, 20, 10, 0]:
    print(f"降低轉速至 {velocity}")
    for motor in [m1_motor, m2_motor, m3_motor, m4_motor]:
        motor.setVelocity(velocity)
    time.sleep(0.5)

print("✅ 安全降落完成！")
```

---

#### 3-2. 常見問題除錯（10 分鐘）

**問題 1：無人機翻覆**

```python
# 原因：轉速太大或馬達設定不平衡
# 解決：
# 1. 降低轉速（55 → 50）
# 2. 確保四個馬達設定相同
# 3. 檢查是否有打錯字
```

**問題 2：無人機飛不起來**

```python
# 原因：轉速太小
# 解決：提高轉速（40 → 55）

# 原因：忘記設定 setPosition(float('inf'))
# 解決：確認有這行程式碼
```

**問題 3：無人機一直飛**

```python
# 原因：忘記降落指令
# 解決：加入降落程式碼

# 原因：sleep 時間太長
# 解決：調整 sleep 時間
```

**除錯流程**：
```
1. 檢查程式是否有語法錯誤
2. 確認所有 motor 都有設定
3. 檢查 sleep 時間是否合理
4. 觀察 3D 視窗的實際動作
5. 調整參數重新測試
```

---

#### 3-3. 作業說明與課程總結（10 分鐘）

**本週作業**：

**作業 1：標準起降（必做）**
```
撰寫一個程式，讓無人機：
1. 起飛至穩定高度
2. 懸停 5 秒
3. 安全降落

要求：
- 使用 time.sleep()
- 包含每個階段的輸出訊息
- 程式碼有適當註解
```

**作業 2：連續起降（必做）**
```
撰寫一個程式，讓無人機：
1. 連續執行 3 次起降
2. 每次起飛後懸停 2 秒
3. 降落後等待 1 秒再起飛

要求：
- 使用 for 迴圈
- 輸出目前是第幾次起降
```

**作業 3：創意飛行（選做，加分）**
```
設計一個有創意的飛行模式，例如：
- 模擬電梯運作
- 階梯式上升與下降
- 跳躍式飛行
- 其他有趣的飛行模式

評分重點：
- 創意性（30%）
- 程式完整性（40%）
- 輸出說明清晰（30%）
```

**繳交方式**：
- 程式檔案：`W3_學號_姓名.py`
- 錄影檔案：錄下模擬器執行畫面（選做）
- 繳交期限：下週上課前

---

**課程總結**：

**今天學到的重點**：
1. ✅ 程式執行的順序性
2. ✅ time.sleep() 的作用與重要性
3. ✅ 無人機起飛與降落控制
4. ✅ 參數調整與實驗精神

**重要概念複習**：
```python
# 順序很重要
起飛() → 懸停() → 降落()

# 等待很重要
起飛()
sleep(3)  # 給無人機時間上升
降落()
```

**下週預告**：
- 📏 精準高度控制
- 🎯 使用參數控制飛行
- 🔢 整數與浮點數運算
- ✈️ 更複雜的飛行任務

---

## 四、教學評量

### 課堂評量
- 能否正確說明 time.sleep() 的作用？
- 能否獨立完成基礎起降任務？
- 能否調整參數改變飛行效果？

### 作業評分標準

| 項目 | 優秀 (90-100) | 良好 (80-89) | 及格 (70-79) | 待加強 (<70) |
|-----|--------------|------------|------------|-------------|
| 程式正確性 | 完美執行所有任務 | 小錯誤但能執行 | 部分功能正常 | 無法執行 |
| 程式碼品質 | 註解完整、結構清晰 | 有註解、結構可 | 註解少、結構亂 | 無註解、難理解 |
| 參數設定 | 飛行平穩流暢 | 飛行尚可 | 飛行不穩 | 無法起飛 |
| 創意度 | 有獨特創意 | 有小創意 | 基本完成 | 未達要求 |

---

## 五、補充資源

### 延伸閱讀
- **time 模組文檔**：https://docs.python.org/3/library/time.html
- **Webots 馬達控制**：https://cyberbotics.com/doc/reference/motor

### 教學影片
- （待建立）W3 起飛降落示範
- （待建立）參數調整技巧

---

**教案版本**：v1.0
**編撰日期**：2026-01-30
**編撰者**：Python Flight Academy 團隊
