# W4：精準高度控制

**課程名稱**：飛行驅動 Python - Week 4
**授課時數**：3 小時（150 分鐘）
**適用對象**：高中學生
**教學日期**：____________
**授課教師**：____________

---

## 一、教學目標

### 知識目標
1. 理解函數參數（Parameters）的概念與用途
2. 掌握整數（int）與浮點數（float）的差異
3. 了解如何透過參數控制無人機飛行高度
4. 認識變數在飛行控制中的應用

### 技能目標
1. 能使用參數控制無人機飛行至指定高度
2. 能設計階梯式高度變化程式
3. 能調整馬達轉速實現不同高度
4. 能使用變數儲存飛行參數

### 態度目標
1. 培養精確控制的觀念
2. 建立參數化思維
3. 養成實驗與測試的習慣

---

## 二、教學準備

### 教師準備
- [ ] 教學簡報（PPT）
- [ ] 高度對照表（轉速 vs 高度）
- [ ] 範例程式碼
- [ ] 實驗記錄表
- [ ] 投影設備

### 學生準備
- [ ] 已完成 W3 作業（供檢討）
- [ ] Webots 環境正常運作
- [ ] 學習筆記本
- [ ] 實驗記錄表

### 教學環境
- [ ] Webots 模擬器已安裝
- [ ] 網路連線穩定
- [ ] 備用電腦

---

## 三、教學流程（150 分鐘）

### 第一節：W3 回顧與參數概念（50 分鐘）

#### 1-1. W3 作業檢討（15 分鐘）

**優秀作業展示**：

**作業 1：標準起降**
- 展示飛行平穩的作業
- 討論轉速參數的選擇
- 分享調整經驗

**作業 2：連續起降**
- 檢查 for 迴圈使用
- 確認每次起降是否完整
- 討論時間控制技巧

**作業 3：創意飛行**
- 展示最有創意的 3 個作品
- 投票選出「最佳創意獎」

**常見問題討論**：

**問題 1：無人機飛行高度不一致**
```python
# 原因：每次起飛的時間不同
m1_motor.setVelocity(55)
time.sleep(2)  # 有時 2 秒不夠

# 改進：調整時間或轉速
time.sleep(2.5)  # 增加時間
# 或
m1_motor.setVelocity(60)  # 增加轉速
```

**問題 2：降落時摔機**
```python
# ❌ 錯誤：直接停止馬達
m1_motor.setVelocity(0)

# ✅ 改進：逐步降低轉速
for speed in [40, 30, 20, 10, 0]:
    m1_motor.setVelocity(speed)
    time.sleep(0.5)
```

---

#### 1-2. 為什麼需要「參數」？（15 分鐘）

**情境引導**：

```
老師：「如果我想讓無人機飛到不同高度，怎麼辦？」

學生可能回答：
- 「改程式碼」
- 「調整 sleep 時間」
- 「改轉速」

老師：「每次都要改程式碼嗎？有沒有更方便的方法？」
→ 引入「參數」的概念
```

**生活中的參數**：

```
🎮 遊戲角色
- 攻擊力：100
- 防禦力：50
- 速度：30

只要改變這些「數值」，角色能力就改變
不用重新設計整個角色！
```

**函數參數類比**：

```python
# 沒有參數的函數
def say_hello():
    print("你好，小明！")

say_hello()  # 只能對小明打招呼

# 有參數的函數
def say_hello(name):
    print(f"你好，{name}！")

say_hello("小明")  # 你好，小明！
say_hello("小華")  # 你好，小華！
say_hello("老師")  # 你好，老師！
```

**重點說明**：
```
參數 = 函數的「輸入值」
可以改變函數的行為
就像：
- 電風扇的「風速」參數（1/2/3 檔）
- 音響的「音量」參數（0-100）
- 無人機的「高度」參數
```

---

#### 1-3. 整數 vs 浮點數（10 分鐘）

**為什麼要區分？**

```python
# 整數（Integer）
age = 16           # 年齡通常用整數
student_count = 30  # 人數一定是整數

# 浮點數（Float）
height = 1.75      # 身高可以有小數
speed = 0.5        # 速度可以有小數
```

**運算結果的差異**：

```python
# 整數除法 vs 一般除法
print(10 / 3)      # 3.333...（浮點數）
print(10 // 3)     # 3（整數）

# 整數 + 浮點數 = 浮點數
a = 5              # 整數
b = 2.5            # 浮點數
c = a + b          # 7.5（浮點數）
print(type(c))     # <class 'float'>
```

**飛行控制中的應用**：

```python
# 飛行時間（整數就夠了）
hover_time = 3     # 3 秒（整數）

# 飛行高度（需要更精確）
target_height = 0.5   # 0.5 公尺（浮點數）
target_height = 0.75  # 0.75 公尺（浮點數）

# 馬達轉速（整數或浮點數都可以）
velocity = 55      # 整數
velocity = 55.5    # 浮點數（更精確）
```

**實驗活動**（5 分鐘）：

```python
# 請學生預測輸出結果
a = 10
b = 3
print(a / b)   # ?
print(a // b)  # ?
print(a % b)   # ?

# 請學生預測資料型態
x = 5
y = 2.0
z = x + y
print(type(z))  # ?
```

---

#### 1-4. 函數參數的使用（10 分鐘）

**無參數函數**：

```python
def takeoff():
    """固定高度起飛"""
    m1_motor.setVelocity(55)
    m2_motor.setVelocity(55)
    m3_motor.setVelocity(55)
    m4_motor.setVelocity(55)
    time.sleep(2)

takeoff()  # 每次都飛到相同高度
```

**有參數函數**：

```python
def takeoff(flight_time):
    """可調整高度的起飛"""
    m1_motor.setVelocity(55)
    m2_motor.setVelocity(55)
    m3_motor.setVelocity(55)
    m4_motor.setVelocity(55)
    time.sleep(flight_time)  # 使用參數控制時間

# 不同高度的起飛
takeoff(1)    # 飛 1 秒（低空）
takeoff(2)    # 飛 2 秒（中空）
takeoff(3)    # 飛 3 秒（高空）
```

**多參數函數**：

```python
def takeoff(flight_time, velocity):
    """同時控制時間和轉速"""
    for motor in motors:
        motor.setVelocity(velocity)
    time.sleep(flight_time)

# 更靈活的控制
takeoff(2, 50)   # 2 秒，轉速 50
takeoff(3, 55)   # 3 秒，轉速 55
takeoff(1, 60)   # 1 秒，轉速 60
```

**教學重點**：
```
參數名稱要有意義！

❌ 不好：def fly(a, b)
✅ 好的：def fly(height, speed)

參數可以有多個
但不要太多（通常 2-4 個）
```

---

### 第二節：高度控制實作（50 分鐘）

#### 2-1. 高度與轉速的關係（15 分鐘）

**實驗目標**：找出轉速與高度的關係

**實驗方法**：

```python
"""
實驗：不同轉速的飛行高度
記錄每個轉速飛行 2 秒後的高度
"""

import time
from controller import Robot

drone = Robot()
timestep = int(drone.getBasicTimeStep())

# 初始化馬達（省略）
motors = []
for i in range(1, 5):
    motor = drone.getDevice(f"m{i}_motor")
    motor.setPosition(float('inf'))
    motor.setVelocity(0)
    motors.append(motor)

# 測試不同轉速
test_velocities = [45, 50, 55, 60, 65]

print("=" * 50)
print("  轉速與高度關係實驗")
print("=" * 50)

for vel in test_velocities:
    print(f"\n測試轉速：{vel}")

    # 起飛
    for motor in motors:
        motor.setVelocity(vel)

    time.sleep(2)  # 飛行 2 秒

    # 觀察高度（在 Webots 中用眼睛觀察）
    print(f"  請觀察並記錄高度")

    # 降落
    for motor in motors:
        motor.setVelocity(0)

    time.sleep(3)  # 等待完全降落

    if vel < test_velocities[-1]:
        input("按 Enter 繼續下一個測試...")

print("\n實驗完成！")
```

**實驗記錄表**（學生填寫）：

| 轉速 | 飛行時間 | 觀察高度 | 備註 |
|-----|---------|---------|------|
| 45  | 2 秒    | 約 ___ cm | 飛不太起來 / 正常 / 太高 |
| 50  | 2 秒    | 約 ___ cm |  |
| 55  | 2 秒    | 約 ___ cm |  |
| 60  | 2 秒    | 約 ___ cm |  |
| 65  | 2 秒    | 約 ___ cm |  |

**討論問題**：
1. 轉速越大，高度越？（高/低）
2. 哪個轉速最穩定？
3. 轉速太小會怎樣？太大呢？

---

#### 2-2. 階梯式高度控制（20 分鐘）

**任務**：讓無人機飛出「階梯」效果

```python
"""
W4 範例：階梯式高度控制
目標：飛到三個不同高度，像爬樓梯一樣
"""

import time
from controller import Robot

drone = Robot()
timestep = int(drone.getBasicTimeStep())

# 初始化馬達
motors = []
for i in range(1, 5):
    motor = drone.getDevice(f"m{i}_motor")
    motor.setPosition(float('inf'))
    motor.setVelocity(0)
    motors.append(motor)

# 定義三個高度（用飛行時間表示）
height_1 = 1.0  # 第一層（1 秒）
height_2 = 2.0  # 第二層（2 秒）
height_3 = 3.0  # 第三層（3 秒）

# 馬達轉速
velocity = 55

print("=" * 50)
print("  階梯式高度飛行")
print("=" * 50)

# 起飛到第一層
print(f"\n第一層：起飛 {height_1} 秒")
for motor in motors:
    motor.setVelocity(velocity)
time.sleep(height_1)
print("  📍 到達第一層")
time.sleep(1)  # 在這層停留 1 秒

# 上升到第二層
print(f"\n第二層：再飛 {height_2 - height_1} 秒")
time.sleep(height_2 - height_1)
print("  📍 到達第二層")
time.sleep(1)

# 上升到第三層
print(f"\n第三層：再飛 {height_3 - height_2} 秒")
time.sleep(height_3 - height_2)
print("  📍 到達第三層（最高點）")
time.sleep(2)

# 降落
print("\n開始降落...")
for motor in motors:
    motor.setVelocity(0)
time.sleep(3)

print("✅ 階梯飛行完成！")
print("=" * 50)

while drone.step(timestep) != -1:
    pass
```

**程式解析**：

```python
# 為什麼是 height_2 - height_1？
# 因為已經飛了 height_1 秒
# 只需要再飛「差值」就能到第二層

height_1 = 1.0  # 已經在第一層（1 秒）
height_2 = 2.0  # 要到第二層（總共 2 秒）

# 需要再飛：2.0 - 1.0 = 1.0 秒
time.sleep(height_2 - height_1)
```

---

#### 2-3. 使用函數封裝（15 分鐘）

**為什麼需要函數？**

```python
# ❌ 沒有函數：程式碼重複
for motor in motors:
    motor.setVelocity(55)
time.sleep(2)

for motor in motors:
    motor.setVelocity(55)
time.sleep(3)

# ✅ 使用函數：簡潔清晰
fly_to_height(2)
fly_to_height(3)
```

**定義飛行函數**：

```python
def fly_to_height(flight_time, velocity=55):
    """
    飛行到指定高度

    參數：
        flight_time: 飛行時間（秒）
        velocity: 馬達轉速（預設 55）
    """
    print(f"飛行 {flight_time} 秒（轉速 {velocity}）")

    for motor in motors:
        motor.setVelocity(velocity)

    time.sleep(flight_time)

# 使用函數
fly_to_height(1)      # 使用預設轉速 55
fly_to_height(2, 60)  # 指定轉速 60
```

**參數預設值**：

```python
def fly_to_height(flight_time, velocity=55):
    #                             ↑ 預設值
    # 如果不提供 velocity，就使用 55
    pass

# 呼叫方式
fly_to_height(2)       # velocity = 55（使用預設值）
fly_to_height(2, 60)   # velocity = 60（覆蓋預設值）
```

**完整範例**：

```python
"""
使用函數的階梯飛行
"""

def fly_to_height(flight_time, velocity=55):
    """飛行到指定高度"""
    for motor in motors:
        motor.setVelocity(velocity)
    time.sleep(flight_time)

def land():
    """降落"""
    for motor in motors:
        motor.setVelocity(0)

# 初始化（省略）

print("開始階梯飛行...")

# 第一層
fly_to_height(1)
print("📍 第一層")
time.sleep(1)

# 第二層
fly_to_height(1)  # 再飛 1 秒
print("📍 第二層")
time.sleep(1)

# 第三層
fly_to_height(1)  # 再飛 1 秒
print("📍 第三層")
time.sleep(2)

# 降落
land()
print("✅ 完成！")
```

---

### 第三節：綜合練習與挑戰（50 分鐘）

#### 3-1. 學生實作練習（25 分鐘）

**練習 1：三段高度飛行（基礎）**

```python
"""
任務：讓無人機依序飛到三個指定高度
要求：
1. 定義三個高度變數（低、中、高）
2. 使用參數控制飛行時間
3. 每個高度停留 1 秒
4. 輸出到達每層的訊息
"""

# TODO：完成程式碼
low_height = ___    # 1 秒
mid_height = ___    # 2 秒
high_height = ___   # 3 秒

# TODO：實現飛行邏輯
```

**練習 2：可調式階梯（進階）**

```python
"""
任務：設計一個可調整階梯數量的程式
要求：
1. 使用變數 steps 控制階梯數量
2. 使用 for 迴圈實現
3. 每階停留時間遞增（1秒、2秒、3秒...）
"""

steps = 4  # 4 階階梯

# TODO：使用 for 迴圈實現
for i in range(1, steps + 1):
    # 提示：每階飛行 1 秒
    # 停留時間 = i 秒
    pass
```

**練習 3：電梯模擬（挑戰）**

```python
"""
任務：模擬電梯運作
要求：
1. 定義樓層列表：[1, 3, 5, 3, 1]
2. 依序飛到每個樓層
3. 每層停留 2 秒
4. 輸出「到達 X 樓」的訊息
"""

floors = [1, 3, 5, 3, 1]

# TODO：實現電梯模擬
```

---

#### 3-2. 飛行挑戰賽（15 分鐘）

**挑戰 1：最高紀錄**

```
目標：在不翻覆的情況下，飛到最高高度
規則：
- 轉速不可超過 70
- 飛行時間不可超過 5 秒
- 必須安全降落

評分：
- 飛行高度（觀察估計）
- 飛行穩定性
- 安全降落
```

**挑戰 2：精準降落**

```
目標：從高空精準降落到起點
要求：
- 飛到最高點（3 秒）
- 設計降落程序
- 降落點距離起點 < 10cm

評分：
- 降落精準度
- 降落過程平穩度
```

**挑戰 3：創意階梯**

```
目標：設計最有創意的階梯飛行
可能的創意：
- 雙向階梯（上-下-上-下）
- 快速階梯（每層 0.5 秒）
- 不等距階梯（1-3-2-4）

評分：
- 創意性
- 執行完整度
- 程式碼品質
```

---

#### 3-3. 作業說明與課程總結（10 分鐘）

**本週作業**：

**作業 1：標準階梯飛行（必做）**
```
撰寫一個程式，讓無人機：
1. 飛到三個不同高度（自訂）
2. 每層停留 1 秒
3. 使用變數儲存高度參數
4. 使用函數封裝飛行邏輯
5. 安全降落

評分標準：
- 程式正確執行（40%）
- 變數命名清晰（20%）
- 使用函數（20%）
- 註解完整（20%）
```

**作業 2：彈性階梯系統（必做）**
```
設計一個可調整的階梯飛行系統：
1. 可調整階梯數量（steps 變數）
2. 可調整每階高度（step_height 變數）
3. 使用 for 迴圈實現
4. 輸出飛行資訊

範例：
steps = 4
step_height = 0.8  # 每階 0.8 秒
→ 飛行 4 階，每階間隔 0.8 秒
```

**作業 3：高度記錄器（選做，加分）**
```
設計一個記錄飛行高度的程式：
1. 定義多個目標高度
2. 依序飛到每個高度
3. 記錄並輸出飛行資訊
4. 計算總飛行時間

範例輸出：
==== 飛行記錄 ====
第 1 次：飛行 1.0 秒，高度：低
第 2 次：飛行 2.0 秒，高度：中
第 3 次：飛行 3.0 秒，高度：高
總飛行時間：6.0 秒
==================
```

**繳交方式**：
- 程式檔案：`W4_學號_姓名.py`
- 實驗記錄表：`W4_學號_姓名_實驗.pdf`
- 繳交期限：下週上課前

---

**課程總結**：

**今天學到的重點**：
1. ✅ 函數參數的概念與使用
2. ✅ 整數與浮點數的差異
3. ✅ 透過參數控制飛行高度
4. ✅ 函數封裝與參數預設值

**重要概念複習**：

```python
# 參數讓函數更靈活
def fly(height):
    # height 是參數
    time.sleep(height)

fly(1)  # 飛到高度 1
fly(2)  # 飛到高度 2

# 整數 vs 浮點數
time_int = 2      # 整數
time_float = 2.5  # 浮點數（更精確）

# 參數預設值
def fly(height, speed=55):
    # speed 有預設值 55
    pass

fly(2)      # speed = 55
fly(2, 60)  # speed = 60
```

**下週預告**：
- 🎯 水平移動控制（前後左右）
- 📐 X-Y 座標系統
- ✈️ 讓無人機畫出各種路徑
- 🔢 多參數函數的進階應用

---

## 四、教學評量

### 形成性評量
- **課堂實驗**：能否完成轉速與高度關係實驗
- **練習完成度**：三個練習的完成情況
- **參與討論**：提問與回答表現

### 總結性評量

**作業評分標準**：

| 項目 | 優秀 (90-100) | 良好 (80-89) | 及格 (70-79) | 待加強 (<70) |
|-----|--------------|------------|------------|-------------|
| 功能正確性 | 完全符合要求 | 小錯誤但能執行 | 部分功能正常 | 無法執行 |
| 參數使用 | 變數命名佳、參數運用得當 | 有使用變數和參數 | 少用變數和參數 | 未使用 |
| 函數設計 | 函數封裝完整 | 有定義函數 | 函數設計不佳 | 未使用函數 |
| 程式碼品質 | 註解完整、結構清晰 | 有註解、結構可 | 註解少、結構亂 | 無註解 |

---

## 五、教學反思

### 教師自我檢核
- [ ] 學生是否理解參數概念？
- [ ] 實驗時間是否充足？
- [ ] 練習難度是否適當？
- [ ] 需要補充什麼內容？

### 學生學習狀況
- 理解參數概念的學生比例：______%
- 完成基礎練習的學生比例：______%
- 需要個別輔導的學生名單：______

---

## 六、補充資源

### 延伸學習
- **函數參數教學**：https://docs.python.org/zh-tw/3/tutorial/controlflow.html#defining-functions
- **整數與浮點數**：https://www.learnpython.org/en/Basic_Operators

### 實驗記錄表範本
（見附件）

---

**教案版本**：v1.0
**編撰日期**：2026-01-30
**編撰者**：Python Flight Academy 團隊
