# W2：Webots 模擬器環境設置

**課程名稱**：飛行驅動 Python - Week 2
**授課時數**：3 小時（150 分鐘）
**適用對象**：高中學生
**教學日期**：____________
**授課教師**：____________

---

## 一、教學目標

### 知識目標
1. 了解什麼是模擬器及其優勢
2. 認識 Webots 模擬器的功能與介面
3. 理解物件導向程式設計的基本概念
4. 認識 import 指令的作用

### 技能目標
1. 能獨立完成 Webots 安裝與設定
2. 能在 Webots 中載入 Crazyflie 無人機模型
3. 能使用 Python 連接模擬器並控制虛擬無人機
4. 能建立物件並呼叫物件的方法

### 態度目標
1. 培養對模擬器學習的興趣
2. 建立「先模擬，再實機」的安全意識
3. 養成程式測試的良好習慣

---

## 二、教學準備

### 教師準備
- [ ] 教學簡報（PPT）
- [ ] Webots 安裝檔案（離線備份）
- [ ] Crazyflie 模型檔案
- [ ] 範例程式碼
- [ ] 示範影片（Crazyflie 飛行）
- [ ] 投影設備與網路連線

### 學生準備
- [ ] 已完成 Python 環境安裝（W1 作業檢查）
- [ ] 個人電腦（需有獨立顯卡，建議）
- [ ] 至少 2GB 可用硬碟空間
- [ ] W1 作業（供檢討）

### 軟體需求
| 軟體 | 版本 | 系統需求 | 下載連結 |
|-----|------|---------|---------|
| Webots | R2023b | 4GB RAM, 獨立顯卡 | https://cyberbotics.com/ |
| Python | 3.8+ | 已安裝（W1） | - |

---

## 三、教學流程（150 分鐘）

### 第一節：W1 作業檢討與模擬器介紹（50 分鐘）

#### 1-1. W1 作業檢討（15 分鐘）

**檢討流程**：
1. 展示 3-5 位同學的優秀作業
2. 討論常見錯誤與改進方法
3. 頒發「最佳創意獎」

**常見錯誤討論**：

**錯誤 1：變數命名不當**
```python
# ❌ 不好的命名
a = "小明"
x = 16
zzz = 1.75

# ✅ 好的命名
name = "小明"
age = 16
height = 1.75
```

**錯誤 2：忘記 f-string 的 f**
```python
name = "小明"

# ❌ 錯誤
print("{name} 你好")  # 輸出：{name} 你好

# ✅ 正確
print(f"{name} 你好")  # 輸出：小明 你好
```

**錯誤 3：整數除法混淆**
```python
# 一般除法（結果為浮點數）
print(10 / 3)    # 3.333...

# 整數除法（結果為整數）
print(10 // 3)   # 3
```

**優秀作業展示**：
- 選出程式碼整潔、註解完整的作業
- 選出創意獨特的計算機程式
- 給予正面鼓勵與建議

---

#### 1-2. 為什麼需要模擬器？（10 分鐘）

**情境引導**：
```
提問：「如果你有一台真的無人機，你敢直接用你的程式讓它飛嗎？」
學生可能回答：「不敢」、「會摔機」、「很危險」
```

**模擬器的優勢**：

| 項目 | 實體無人機 | 模擬器 |
|-----|----------|--------|
| 💰 成本 | 高（$10,000+） | 免費 |
| ⚠️ 風險 | 可能損壞、受傷 | 零風險 |
| 🏠 場地 | 需要飛行空間 | 電腦即可 |
| 🔋 電池 | 需充電、有限 | 無限制 |
| 🐛 除錯 | 難以觀察細節 | 可暫停、慢動作 |
| 📚 學習 | 只能在課堂 | 可在家練習 |

**真實案例分享**：
- 業界如何使用模擬器（汽車、飛機、機器人）
- NASA 使用模擬器訓練太空人
- 自駕車公司用模擬器測試百萬公里

**教學策略**：
- 播放 Webots 官方展示影片（2 分鐘）
- 展示 Crazyflie 在 Webots 中的飛行效果

---

#### 1-3. 認識 Webots 模擬器（10 分鐘）

**什麼是 Webots？**
- 開源的機器人模擬器
- 支援多種機器人（輪型、人型、飛行器）
- 物理引擎模擬真實世界
- 教育版完全免費

**Webots 可以模擬什麼？**
- 🚗 自走車
- 🤖 機器人
- 🚁 無人機（Crazyflie）
- 🦾 機械手臂
- 🏭 工廠自動化

**為什麼選擇 Webots？**
1. **免費開源**：教育用途完全免費
2. **內建 Crazyflie**：官方支援的無人機模型
3. **物理真實**：模擬真實的飛行動態
4. **跨平台**：支援 Windows、Mac、Linux
5. **Python 支援**：可以直接用 Python 控制

---

#### 1-4. 系統需求檢查（5 分鐘）

**最低需求**：
- 作業系統：Windows 10+、macOS 10.15+、Linux
- RAM：4GB（建議 8GB）
- 顯卡：支援 OpenGL 3.3+
- 硬碟空間：2GB

**檢查方式**：
```bash
# Windows：按 Win+R，輸入 dxdiag
# Mac：關於這台 Mac > 系統報告
# Linux：輸入 glxinfo | grep "OpenGL version"
```

**常見問題預防**：
- 老舊電腦可能運行緩慢（建議降低畫質）
- 虛擬機中可能無法運行（需實體機）
- 整合顯卡可能效能較差（可用但較慢）

---

#### 1-5. 安裝 Webots 教學（10 分鐘）

**安裝步驟**（教師投影示範）：

**Step 1：下載 Webots**
1. 前往 https://cyberbotics.com/
2. 點擊 "Download"
3. 選擇對應的作業系統
4. 下載 R2023b 版本（最新穩定版）

**Step 2：安裝 Webots**

**Windows**：
1. 執行下載的 `.exe` 檔案
2. 選擇安裝路徑（建議預設）
3. 勾選 "Add to PATH"
4. 等待安裝完成

**Mac**：
1. 打開 `.dmg` 檔案
2. 拖曳 Webots 到應用程式資料夾
3. 首次開啟需允許權限

**Linux**：
```bash
sudo apt-get update
sudo apt-get install webots
```

**Step 3：首次啟動**
1. 開啟 Webots
2. 可能需要安裝額外的函式庫（跟隨提示）
3. 出現歡迎畫面即安裝成功

**學生實作**（同步進行）：
- 學生依照步驟安裝 Webots
- 教師與助教巡視協助
- 記錄遇到問題的學生

---

### 第二節：Webots 介面與 Crazyflie 模型（50 分鐘）

#### 2-1. Webots 介面導覽（15 分鐘）

**介面區域說明**：

```
┌─────────────────────────────────────────────┐
│  選單列 (File, Edit, View, Simulation...)  │
├──────────┬──────────────────────┬───────────┤
│          │                      │           │
│  場景樹  │     3D 視窗          │  文字編輯 │
│ (Scene   │   (3D View)          │  (Text    │
│  Tree)   │                      │  Editor)  │
│          │                      │           │
│          │                      │           │
├──────────┴──────────────────────┴───────────┤
│            控制列 (Play, Pause, Reset...)    │
└─────────────────────────────────────────────┘
```

**1. 場景樹（Scene Tree）**
- 顯示模擬世界中的所有物件
- 可選擇、修改物件屬性
- 階層式結構（父子關係）

**2. 3D 視窗（3D View）**
- 顯示模擬環境
- 可旋轉、縮放視角
- 即時顯示機器人動作

**3. 文字編輯器（Text Editor）**
- 撰寫控制器程式碼
- 支援 Python、C、Java 等
- 整合除錯功能

**4. 控制列**
- ▶️ Play：開始模擬
- ⏸️ Pause：暫停模擬
- ⏹️ Stop：停止模擬
- 🔄 Reset：重設模擬

**操作練習**（5 分鐘）：
- 滑鼠左鍵拖曳：旋轉視角
- 滑鼠滾輪：縮放
- 滑鼠中鍵拖曳：平移視角
- Ctrl + 左鍵：選擇物件

---

#### 2-2. 載入 Crazyflie 範例世界（10 分鐘）

**載入步驟**：

**方法 1：從範例載入**
1. 點擊 `File` > `Open World`
2. 瀏覽到 Webots 安裝目錄
3. 路徑：`projects/robots/bitcraze/crazyflie/worlds/`
4. 選擇 `crazyflie.wbt`
5. 點擊 `Open`

**方法 2：從歡迎頁面**
1. 開啟 Webots
2. 在歡迎頁面選擇 "Examples"
3. 搜尋 "Crazyflie"
4. 點擊載入

**成功載入後的畫面**：
- 可以看到一個地板
- 中央有一台 Crazyflie 無人機模型
- 場景樹中顯示 Crazyflie 物件

**場景元素介紹**：
```
WorldInfo         # 世界設定（重力、物理參數）
  └─ basicTimeStep: 8ms

Viewpoint         # 觀察視角
  └─ 可自由調整

RectangleArena    # 地板/場地
  └─ 提供飛行空間

Crazyflie         # 無人機本體
  ├─ Controller: crazyflie_controller_py
  ├─ 4 個馬達
  └─ 感測器
```

---

#### 2-3. 認識 Crazyflie 控制器（15 分鐘）

**什麼是控制器（Controller）？**
```
控制器 = 無人機的「大腦」程式
負責：
1. 讀取感測器資料
2. 計算飛行指令
3. 控制馬達轉速
```

**查看控制器程式**：
1. 在場景樹中選擇 Crazyflie
2. 展開 "controller" 欄位
3. 看到 `crazyflie_controller_py`
4. 雙擊可開啟程式碼

**基本控制器結構**：
```python
from controller import Robot

# 初始化機器人
robot = Robot()

# 取得時間步長
timestep = int(robot.getBasicTimeStep())

# 主迴圈
while robot.step(timestep) != -1:
    # 這裡寫控制邏輯
    pass
```

**重點概念講解**：

**1. 時間步長（Time Step）**
```
時間步長 = 模擬器更新的時間間隔
預設 8ms = 每秒更新 125 次
數值越小越精確，但計算越慢
```

**2. 主迴圈（Main Loop）**
```python
while robot.step(timestep) != -1:
    # 這個迴圈會不斷執行
    # 直到按下停止按鈕
```

**3. robot.step() 的作用**
```
robot.step(timestep)
↓
1. 推進模擬時間
2. 更新感測器數據
3. 執行物理計算
4. 回傳 -1 表示應該停止
```

---

#### 2-4. 執行第一個模擬（10 分鐘）

**執行步驟**：
1. 確保 Crazyflie 世界已載入
2. 點擊控制列的 ▶️ Play 按鈕
3. 觀察 3D 視窗

**預期結果**：
- 無人機應該會啟動馬達
- 可能會有輕微震動
- 但不會起飛（預設程式沒有起飛指令）

**教師示範**：
```python
# 修改控制器，讓馬達轉動
from controller import Robot

robot = Robot()
timestep = int(robot.getBasicTimeStep())

# 取得四個馬達
m1_motor = robot.getDevice("m1_motor")
m2_motor = robot.getDevice("m2_motor")
m3_motor = robot.getDevice("m3_motor")
m4_motor = robot.getDevice("m4_motor")

# 設定馬達為速度控制模式
m1_motor.setPosition(float('inf'))
m2_motor.setPosition(float('inf'))
m3_motor.setPosition(float('inf'))
m4_motor.setPosition(float('inf'))

# 設定馬達速度（讓它轉動）
m1_motor.setVelocity(10.0)
m2_motor.setVelocity(10.0)
m3_motor.setVelocity(10.0)
m4_motor.setVelocity(10.0)

print("馬達已啟動！")

while robot.step(timestep) != -1:
    pass
```

**學生觀察任務**：
- 注意馬達是否轉動？
- 無人機有什麼反應？
- 輸出視窗顯示什麼訊息？

---

### 第三節：物件導向初步與實作練習（50 分鐘）

#### 3-1. 物件導向概念介紹（15 分鐘）

**生活中的物件**：

```
🚗 汽車物件
├─ 屬性（Attributes）
│  ├─ 顏色：紅色
│  ├─ 品牌：Toyota
│  └─ 速度：0 km/h
└─ 方法（Methods）
   ├─ 啟動()
   ├─ 加速()
   ├─ 煞車()
   └─ 停止()
```

**Python 中的物件**：

```python
# 📱 手機物件範例
class Phone:
    def __init__(self, brand):
        self.brand = brand
        self.battery = 100

    def call(self, number):
        print(f"撥打電話給 {number}")

    def charge(self):
        self.battery = 100
        print("充電完成")

# 建立物件
my_phone = Phone("iPhone")
my_phone.call("0912345678")
my_phone.charge()
```

**無人機物件**：

```python
# 🚁 無人機物件
from controller import Robot

# Robot 是一個「類別」(Class)
# robot 是一個「物件」(Object)
robot = Robot()

# 物件有「屬性」
timestep = robot.getBasicTimeStep()

# 物件有「方法」
robot.step(timestep)        # 推進模擬
motor = robot.getDevice("m1_motor")  # 取得裝置
```

**重點說明**：
```
類別 (Class) = 藍圖、設計圖
物件 (Object) = 根據藍圖製造的實體

就像：
房屋設計圖 (Class) → 實際的房子 (Object)
蛋糕食譜 (Class) → 做出的蛋糕 (Object)
```

---

#### 3-2. import 指令詳解（10 分鐘）

**為什麼需要 import？**

```python
# ❌ 沒有 import，無法使用 Robot
robot = Robot()  # 錯誤！Python 不知道 Robot 是什麼

# ✅ 正確做法
from controller import Robot
robot = Robot()  # 正確！
```

**import 的作用**：
```
import = 匯入、導入
把別人寫好的程式碼「借來用」

就像：
import 數學工具箱 → 可以用計算機、圓規、量角器
import 廚房工具 → 可以用鍋子、刀具、烤箱
```

**不同的 import 方式**：

**方式 1：import 整個模組**
```python
import math

print(math.pi)       # 3.14159...
print(math.sqrt(16)) # 4.0
```

**方式 2：from...import 特定功能**
```python
from math import pi, sqrt

print(pi)            # 3.14159...
print(sqrt(16))      # 4.0
```

**方式 3：import 並重新命名**
```python
import math as m

print(m.pi)
print(m.sqrt(16))
```

**Webots 的 import**：
```python
# 從 controller 模組匯入 Robot 類別
from controller import Robot

# 如果需要其他功能
from controller import Robot, Motor, GPS
```

---

#### 3-3. 第一個無人機控制程式（15 分鐘）

**完整範例程式**：

```python
"""
W2 實作：我的第一個無人機控制程式
功能：啟動無人機並輸出訊息
"""

# 匯入 Robot 類別
from controller import Robot

# 建立機器人物件
drone = Robot()
print("✈️ 無人機物件已建立！")

# 取得時間步長
timestep = int(drone.getBasicTimeStep())
print(f"⏱️ 時間步長：{timestep} ms")

# 取得無人機名稱
name = drone.getName()
print(f"🏷️ 無人機名稱：{name}")

# 主迴圈
print("🚀 模擬開始...")
step_count = 0

while drone.step(timestep) != -1:
    step_count += 1

    # 每 100 步輸出一次訊息
    if step_count % 100 == 0:
        print(f"已執行 {step_count} 步")

    # 執行 500 步後結束
    if step_count >= 500:
        print("✅ 模擬結束")
        break

print(f"總共執行了 {step_count} 步")
```

**程式講解**：

1. **建立物件**
```python
drone = Robot()  # 不是 Robot，而是 Robot()
#              ↑ 括號表示「呼叫建構函數」
```

2. **取得時間步長**
```python
timestep = int(drone.getBasicTimeStep())
#          ↑ 轉換為整數
#               ↑ 呼叫方法（注意括號）
```

3. **主迴圈**
```python
while drone.step(timestep) != -1:
#     ↑ 每次迴圈都要呼叫 step()
#     ↑ 否則模擬不會前進
```

---

#### 3-4. 學生實作練習（10 分鐘）

**練習 1：修改輸出訊息**
```python
# 請修改程式，輸出你自己的訊息
from controller import Robot

drone = Robot()

# TODO：輸出「我的無人機準備起飛！」
print("____________")

# TODO：輸出無人機名稱
name = ____________
print(f"無人機：{name}")

timestep = int(drone.getBasicTimeStep())

while drone.step(timestep) != -1:
    pass
```

**練習 2：計算模擬時間**
```python
# 計算並輸出模擬了多少秒
from controller import Robot

drone = Robot()
timestep = int(drone.getBasicTimeStep())

step_count = 0
max_steps = 1000

while drone.step(timestep) != -1:
    step_count += 1

    if step_count >= max_steps:
        break

# TODO：計算總模擬時間（秒）
# 提示：總時間 = 步數 × 時間步長 / 1000
total_time = ____________

print(f"總共模擬了 {total_time} 秒")
```

**教師巡視要點**：
- 檢查 import 語法是否正確
- 確認括號、縮排無誤
- 協助除錯執行錯誤

---

## 四、作業說明與課程總結（10 分鐘）

### 本週作業

**作業 1：環境檢核（必做）**
- 完成 Webots 安裝
- 成功載入 Crazyflie 範例
- 截圖證明安裝成功

**作業 2：物件練習（必做）**
撰寫一個程式，完成以下要求：
```python
# 1. 匯入 Robot 類別
# 2. 建立無人機物件
# 3. 輸出以下資訊：
#    - 無人機名稱
#    - 時間步長
#    - 模擬開始訊息
# 4. 執行 100 步模擬
# 5. 計算並輸出總模擬時間
```

**作業 3：創意輸出（選做，加分）**
設計一個有創意的模擬開始畫面，例如：
```
========================================
    ✈️ 飛行驅動 Python 模擬器 ✈️
========================================
無人機型號：Crazyflie 2.1
系統狀態：✅ 正常
電池電量：🔋🔋🔋🔋🔋 100%
準備起飛...
========================================
```

**繳交方式**：
- 程式檔案：`W2_學號_姓名.py`
- 截圖檔案：`W2_學號_姓名.png`
- 繳交期限：下週上課前

---

### 課程總結

**今天學習的內容**：
1. ✅ Webots 模擬器安裝與介面
2. ✅ 物件導向基本概念（類別、物件、方法）
3. ✅ import 指令的使用
4. ✅ 第一個無人機控制程式

**重點回顧**：
```python
# 物件的建立
from controller import Robot
drone = Robot()  # drone 是一個物件

# 呼叫物件的方法
timestep = drone.getBasicTimeStep()  # 有括號
name = drone.getName()                # 有括號

# 主迴圈
while drone.step(timestep) != -1:
    # 控制邏輯
```

**下週預告**：
- 🚁 讓無人機真正飛起來！
- 📐 學習起飛與降落控制
- ⏱️ 使用 time.sleep() 控制時間
- 🎯 完成第一次虛擬飛行任務

---

## 五、教學評量

### 形成性評量
- **安裝檢核**：是否成功安裝 Webots（100%）
- **課堂參與**：提問、討論、實作表現
- **理解檢測**：能否說明物件與方法的差異

### 總結性評量
- **作業 1**：環境檢核截圖（30%）
- **作業 2**：物件練習程式（50%）
- **作業 3**：創意輸出（20%，加分項）

---

## 六、補充資源

### Webots 官方資源
- **官方文檔**：https://cyberbotics.com/doc/guide/
- **Python API**：https://cyberbotics.com/doc/reference/robot
- **範例程式**：Webots 內建 examples 資料夾

### 物件導向學習
- **互動式教學**：https://www.learnpython.org/en/Classes_and_Objects
- **影片教學**：YouTube 搜尋「Python 物件導向」

---

**教案版本**：v1.0
**編撰日期**：2026-01-30
**編撰者**：Python Flight Academy 團隊
